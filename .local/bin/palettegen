#!/usr/bin/env sh
# source: https://softwarerecs.stackexchange.com/questions/14649/is-there-an-open-source-program-thatll-extract-the-color-from-an-image?newreg=456544a54a264d80b91f568341a8a605

convert $1 -colors 16 -depth 8 -format '%c' histogram:info:- \
    | sort --reverse --numeric-sort \
    | gawk 'match ($0, /^ *[0-9]+: \([^)]+\) (#[0-9A-F]+) .+$/, a) { print a[1] }' \
    | tee "palette.txt" \
    | while read colour; do convert -size 20x20 "xc:$colour" +depth miff:-; done \
    | montage - -geometry +0+0 "palette.png"
